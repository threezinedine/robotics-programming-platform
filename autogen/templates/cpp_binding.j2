#include <pybind11/pybind11.h>
#include "core/core.h"
#include "modules/modules.h"
#include "applications/applications.h"

namespace py = pybind11;
using namespace rpp;

namespace pybind11
{
namespace detail
{
    template <>
    struct type_caster<String>
    {
        PYBIND11_TYPE_CASTER(String, _("str"));

        static handle
        cast (const String &src, return_value_policy /* policy */, handle /* parent */)
        {
            return pybind11::cast<std::string>(std::string(src.CStr())).release();
        }

        bool load(handle src, bool)
        {
            if (!py::isinstance<py::str>(src))
            {
                return false;
            }

            value = String(std::string(py::str(src)).c_str());
        }
    };
}
}

PYBIND11_MODULE(Engine, m) {
    {% include "cpp_enum_binding.j2" %}

    // ================ Struct Bindings ================
    {% include "cpp_struct_binding.j2" %}

    {% include "cpp_function_binding.j2" %}

    // ================ Class Bindings ================
    {% include "cpp_class_binding.j2" %}

    {% include "cpp_to_string_method.j2" %}
}